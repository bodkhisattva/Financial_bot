# Telegram-бот для прогнозирования цен акций 

Учебный проект по дисциплине **«Временные ряды»**.  
Бот позволяет пользователю получать прогноз цен акций, рекомендации по торговым стратегиям и оценку потенциальной прибыли.

Проект реализует полный пайплайн:
- загрузка исторических данных с Yahoo Finance,
- обучение нескольких моделей временных рядов,
- автоматический выбор лучшей модели,
- прогноз на 30 торговых дней,
- визуализация,
- генерация торговых рекомендаций,
- логирование всех запросов.

Также в проекте предусмотрено кэширование загрузки данных с Yahoo Finance, чтобы бот мог обращаться к уже полученным данным.


## Используемые технологии

- Python 3.10+
- aiogram — Telegram Bot API
- yfinance — загрузка котировок
- pandas, numpy — работа с временными рядами
- scikit-learn — ML-модель (Ridge)
- statsmodels — статистическая модель (SARIMAX)
- tensorflow — нейросетевая модель (LSTM)
- matplotlib — визуализация
- CSV — хранение кэша и логов

---

## Структура проекта

project/
│
├── bot.py # основной файл Telegram-бота
├── utils.py # загрузка данных, кэш, логирование, метрики
├── models.py # реализация Ridge, SARIMAX, LSTM и выбор лучшей модели
├── recommender.py # торговая стратегия (Продавать / Покупать)
├── plots.py # построение графиков
├── requirements.txt # зависимости проекта
├── logs.csv # журнал логов (создаётся автоматически)
│
├── cache/ # локальный кэш CSV по тикерам
│ ├── AAPL.csv
│ ├── MSFT.csv
│ └── ...

## Установка зависимостей

Создайте виртуальное окружение и установи библиотеки:

bash
pip install -r requirements.txt

Содержимое requirements.txt:

aiogram==3.7.0
yfinance==0.2.43
pandas==2.2.2
numpy==1.26.4
matplotlib==3.9.0
scikit-learn==1.5.1
statsmodels==0.14.2
tensorflow==2.17.0
requests==2.32.3

Запуск бота

    Создайте бота в Telegram через @BotFather

    Получите токен

    Вставьте токен в bot.py:

BOT_TOKEN = "ВАШ_TELEGRAM_TOKEN"

    Запустите:

python bot.py

После этого бот станет доступен в Telegram.
Использование бота

    Отправьте команду:

/start

    Введите тикер:

AAPL

    Введите сумму:

10000

Бот вернёт:

    график истории и прогноза,

    метрики моделей,

    выбранную лучшую модель,

    прогноз на 30 торговых дней,

    рекомендации покупать / продавать,

    расчёт условной прибыли.

Кэширование данных (cache)

Для повышения устойчивости работы реализован локальный кэш:

cache/{TICKER}.csv

Формат CSV:

Date,price
2023-01-03,130.28
2023-01-04,127.85
...

Алгоритм работы:

    Сначала бот пытается загрузить данные из cache/

    Если файла нет — обращается к Yahoo Finance

    Успешно загруженные данные автоматически сохраняются в cache/

Это позволяет:

    избежать частых запросов к Yahoo,

    избежать ошибки 429 (которая часто возникала во время создания проекта).

Ограничения Yahoo Finance

Yahoo Finance использует rate limit.
При большом числе запросов может появиться ошибка:

429 Too Many Requests

В проекте реализовано:

    задержка между запросами одного пользователя,

    повторные попытки загрузки,

    fallback на локальный кэш.

Рекомендации:

    не делать частые запросы подряд,

    при ошибке подождать 1–5 минут,

    использовать предварительно заполненный кэш,

    при необходимости сменить сеть / VPN.

Логирование

Каждый запрос пользователя записывается в logs.csv:

timestamp_utc	дата и время
user_id	ID пользователя
ticker	тикер
amount	сумма
best_model	лучшая модель
rmse, mape, mae	метрики
potential_profit	условная прибыль
train_time_sec	время обучения
total_request_time_sec	общее время запроса
Реализованные модели

Классическая ML	Ridge Regression с лаговыми признаками
Статистическая	SARIMAX
Нейросетевая	LSTM

Лучшая модель выбирается автоматически по минимальному RMSE на тестовой выборке.
Стратегия торговли

    Покупать — локальный минимум прогноза

    Продавать — локальный максимум прогноза

    Итог: условная прибыль на введённую сумму

Стратегия демонстрационная и используется для обучения.
